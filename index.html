<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Arcadian Phone</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
  :root{
    --bg: radial-gradient(1200px 800px at 20% 10%, #3b2d63 0%, #231b3e 45%, #0f0f23 100%);
    --pane: rgba(20,18,38,.6);
    --gold: #d4af37;
    --ink: #e8d5b7;
    --accent: #9b7dff;
    --veil: rgba(255,255,255,.08);
    --line: rgba(255,255,255,.15);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; background:var(--bg); color:var(--ink); font-family:"Cormorant Garamond", serif; display:grid; place-items:center; padding:24px}
  .phone{
    width:360px; max-width:94vw; height:720px; max-height:94vh;
    border-radius:36px; background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    border:1px solid var(--line); box-shadow:0 20px 60px rgba(0,0,0,.5), inset 0 0 60px rgba(255,255,255,.04);
    position:relative; overflow:hidden; backdrop-filter: blur(8px);
  }
  .bezel{position:absolute; inset:0; pointer-events:none}
  .notch{position:absolute; top:0; left:50%; transform:translateX(-50%); width:180px; height:28px; background:rgba(0,0,0,.45); border-radius:0 0 18px 18px}
  .status{position:absolute; top:10px; left:14px; right:14px; font-size:12px; display:flex; justify-content:space-between; opacity:.9}
  .screen{position:absolute; inset:0; padding:56px 16px 16px 16px;}
  .dock{position:absolute; left:0; right:0; bottom:0; padding:12px 16px 18px; display:flex; gap:12px; justify-content:center; background:linear-gradient(180deg, transparent, rgba(0,0,0,.25));}
  .btn{appearance:none; border:none; background:var(--veil); color:var(--ink); border:1px solid var(--line); padding:10px 14px; border-radius:12px; cursor:pointer; font-family:Cinzel, serif; font-size:.95rem}
  .btn.gold{background:linear-gradient(45deg, var(--gold), #b8941f); color:#1a1a2e; font-weight:600}
  .grid{display:grid; grid-template-columns:repeat(3,1fr); gap:14px}
  .icon{
    display:grid; place-items:center; gap:6px; padding:14px 8px; border-radius:18px;
    background:rgba(255,255,255,.06); border:1px solid var(--line); cursor:pointer; text-align:center;
    transition:.2s transform, .2s box-shadow;
  }
  .icon:hover{transform:translateY(-3px); box-shadow:0 10px 20px rgba(0,0,0,.3)}
  .icon .glyph{width:46px; height:46px; border-radius:14px; display:grid; place-items:center; font-size:22px; background:linear-gradient(135deg, rgba(155,125,255,.25), rgba(255,180,230,.18));}
  .icon .label{font-size:.95rem; opacity:.95; font-family:Cinzel, serif}

  .card{background:var(--pane); border:1px solid var(--line); border-radius:16px; padding:12px; backdrop-filter: blur(8px)}
  .row{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
  .bar{display:flex; align-items:center; justify-content:space-between; margin-bottom:10px}
  .title{font-family:Cinzel, serif; letter-spacing:.5px}
  .hidden{display:none}

  /* Gallery */
  #galleryView .thumbs{display:grid; grid-template-columns:repeat(3, 1fr); gap:8px; max-height:480px; overflow:auto}
  #galleryView img{width:100%; height:100px; object-fit:cover; border-radius:10px; border:1px solid var(--line)}

  /* Camera */
  #camView video, #camView canvas { width:100%; height:260px; background:#000; border-radius:12px; border:1px solid var(--line); object-fit:cover }
  .filters{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
  .chip{padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:rgba(255,255,255,.05); cursor:pointer; font-size:.9rem}
  .chip.active{background:rgba(155,125,255,.2); border-color:var(--accent)}

  /* Notes */
  #notesView .note{background:rgba(255,255,255,.06); border:1px solid var(--line); border-radius:12px; padding:8px 10px}
  #notesList{display:grid; gap:8px; max-height:380px; overflow:auto}
  textarea{width:100%; min-height:120px; border-radius:10px; padding:10px; border:1px solid var(--line); background:rgba(0,0,0,.35); color:var(--ink); resize:vertical}

  /* Oracle */
  #oracleView .paper{min-height:150px; border-radius:12px; border:1px dashed var(--line); padding:12px; font-style:italic}

  /* Settings */
  .swatch{width:22px; height:22px; border-radius:50%; border:1px solid var(--line); cursor:pointer}
  .swatches{display:flex; gap:10px}

</style>
</head>
<body>
  <div class="phone">
    <div class="bezel">
      <div class="notch"></div>
      <div class="status"><span id="clock">--:--</span><span>ARCADIA ‚óâ‚óâ‚óâ</span></div>
    </div>
    <div class="screen">
      <!-- HOME -->
      <div id="homeView">
        <div class="bar"><h3 class="title">Arcadian Phone</h3></div>
        <div class="grid">
          <div class="icon" data-open="galleryView"><div class="glyph">üñºÔ∏è</div><div class="label">Gallery</div></div>
          <div class="icon" data-open="camView"><div class="glyph">üì∑</div><div class="label">Camera</div></div>
          <div class="icon" data-open="notesView"><div class="glyph">üìù</div><div class="label">Notes</div></div>
          <div class="icon" data-open="oracleView"><div class="glyph">üîÆ</div><div class="label">Oracle</div></div>
          <div class="icon" data-open="settingsView"><div class="glyph">‚öôÔ∏è</div><div class="label">Settings</div></div>
        </div>
      </div>

      <!-- GALLERY -->
      <div id="galleryView" class="hidden">
        <div class="bar">
          <button class="btn" data-open="homeView">‚Üê Home</button>
          <h3 class="title">Gallery</h3>
          <label class="btn gold">
            + Add
            <input id="addImg" type="file" accept="image/*" hidden>
          </label>
        </div>
        <div class="card">
          <div class="thumbs" id="thumbs"></div>
        </div>
      </div>

      <!-- CAMERA -->
      <div id="camView" class="hidden">
        <div class="bar">
          <button class="btn" data-open="homeView">‚Üê Home</button>
          <h3 class="title">Camera</h3>
          <button class="btn gold" id="shutter">Capture</button>
        </div>
        <div class="card">
          <video id="video" playsinline autoplay muted></video>
          <canvas id="frame" class="hidden"></canvas>
          <div class="filters" id="filters"></div>
          <small>Tip: camera needs HTTPS (or localhost). Captures save into Gallery.</small>
        </div>
      </div>

      <!-- NOTES -->
      <div id="notesView" class="hidden">
        <div class="bar">
          <button class="btn" data-open="homeView">‚Üê Home</button>
          <h3 class="title">Notes</h3>
          <button class="btn gold" id="saveNote">Save</button>
        </div>
        <div class="card" style="margin-bottom:10px">
          <textarea id="noteText" placeholder="Write a mystical note‚Ä¶ (e.g., ‚Äòthe moon hums in amethyst tonight‚Äô)" ></textarea>
          <div class="row" style="margin-top:8px">
            <button class="btn" id="newNote">New</button>
            <button class="btn" id="seedNote">Inspire ‚ú®</button>
          </div>
        </div>
        <div class="card">
          <div class="bar"><strong>Archive</strong><button class="btn" id="clearNotes">Clear</button></div>
          <div id="notesList"></div>
        </div>
      </div>

      <!-- ORACLE -->
      <div id="oracleView" class="hidden">
        <div class="bar">
          <button class="btn" data-open="homeView">‚Üê Home</button>
          <h3 class="title">Oracle</h3>
          <button class="btn gold" id="cast">Cast</button>
        </div>
        <div class="card">
          <div class="paper" id="prophecy">Ask, and Arcadia will answer‚Ä¶</div>
          <div class="row" style="margin-top:10px">
            <input id="question" class="btn" style="flex:1" placeholder="Type a question‚Ä¶">
            <button class="btn" id="saveProphecy">Save to Notes</button>
          </div>
        </div>
      </div>

      <!-- SETTINGS -->
      <div id="settingsView" class="hidden">
        <div class="bar">
          <button class="btn" data-open="homeView">‚Üê Home</button>
          <h3 class="title">Settings</h3>
          <span></span>
        </div>
        <div class="card">
          <div class="row" style="justify-content:space-between">
            <div>
              <div class="title" style="font-size:1.1rem">Accent</div>
              <div class="swatches">
                <div class="swatch" style="background:#9b7dff" data-accent="#9b7dff"></div>
                <div class="swatch" style="background:#ff66c4" data-accent="#ff66c4"></div>
                <div class="swatch" style="background:#7bd389" data-accent="#7bd389"></div>
                <div class="swatch" style="background:#ffd166" data-accent="#ffd166"></div>
              </div>
            </div>
            <div>
              <div class="title" style="font-size:1.1rem">Theme</div>
              <div class="row">
                <button class="btn" id="themeArcadia">Arcadia</button>
                <button class="btn" id="themeDawn">Dawn</button>
                <button class="btn" id="themeNight">Night</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
    <div class="dock">
      <button class="btn" data-open="homeView">‚óÅ Home</button>
      <button class="btn" data-open="galleryView">üñºÔ∏è</button>
      <button class="btn" data-open="camView">üì∑</button>
      <button class="btn" data-open="notesView">üìù</button>
      <button class="btn" data-open="oracleView">üîÆ</button>
    </div>
  </div>

<script>
// ---------- Router ----------
const views = ["homeView","galleryView","camView","notesView","oracleView","settingsView"];
function openView(id){
  views.forEach(v=>document.getElementById(v).classList.toggle('hidden', v!==id));
  if(id==='camView') startCamera();
  if(id!=='camView') stopCameraIfUnused();
  if(id==='galleryView') renderThumbs();
  if(id==='notesView') renderNotes();
}
document.querySelectorAll('[data-open]').forEach(el=> el.addEventListener('click', ()=> openView(el.dataset.open)) );
openView('homeView');

// ---------- Clock ----------
setInterval(()=>{
  const d = new Date();
  const t = d.toLocaleTimeString([],{hour:'2-digit', minute:'2-digit'});
  document.getElementById('clock').textContent = t;
}, 1000);

// ---------- Gallery ----------
const thumbsEl = document.getElementById('thumbs');
function renderThumbs(){
  const items = JSON.parse(localStorage.getItem('arcadia.gallery')||'[]');
  thumbsEl.innerHTML = '';
  items.forEach((src,i)=>{
    const img = new Image(); img.src = src; img.alt = `capture-${i}`; img.loading='lazy';
    img.addEventListener('click', ()=> openLightbox(src));
    thumbsEl.appendChild(img);
  });
}
function saveToGallery(dataUrl){
  const items = JSON.parse(localStorage.getItem('arcadia.gallery')||'[]');
  items.unshift(dataUrl); // newest first
  localStorage.setItem('arcadia.gallery', JSON.stringify(items.slice(0,60)));
  renderThumbs();
}
function openLightbox(src){
  const w = window.open('','_blank');
  w.document.write(`<img src="${src}" style="width:100%;height:100%;object-fit:contain;background:#000">`);
}

document.getElementById('addImg').addEventListener('change', e=>{
  const file = e.target.files[0]; if(!file) return;
  const reader = new FileReader();
  reader.onload = ev => { saveToGallery(ev.target.result); };
  reader.readAsDataURL(file);
  e.target.value = '';
});

// ---------- Camera with filters ----------
let stream = null; let currentFilter = 'none';
const filterDefs = [
  {key:'none', label:'None', css:'none'},
  {key:'twilight', label:'Twilight Veil', css:'contrast(1.05) saturate(1.1) hue-rotate(310deg)'},
  {key:'moonstone', label:'Moonstone Drift', css:'contrast(1.1) saturate(1.2) hue-rotate(210deg) brightness(1.05)'},
  {key:'obsidian', label:'Obsidian Guard', css:'grayscale(.3) contrast(1.25) brightness(.9)'},
  {key:'fuchsia', label:'Fuchsia Bloom', css:'saturate(1.4) hue-rotate(330deg) brightness(1.05)'},
  {key:'meadow', label:'Oracle Meadow', css:'saturate(1.25) hue-rotate(80deg)'}
];

const video = document.getElementById('video');
const canvas = document.getElementById('frame');
const ctx = canvas.getContext('2d');
const filtersWrap = document.getElementById('filters');

function buildFilterChips(){
  filtersWrap.innerHTML = '';
  filterDefs.forEach(f=>{
    const chip = document.createElement('button'); chip.className='chip'; chip.textContent=f.label; chip.dataset.key=f.key;
    if(f.key===currentFilter) chip.classList.add('active');
    chip.addEventListener('click', ()=>{
      currentFilter = f.key; updateVideoFilter();
      document.querySelectorAll('.chip').forEach(c=>c.classList.toggle('active', c.dataset.key===currentFilter));
    });
    filtersWrap.appendChild(chip);
  });
}

async function startCamera(){
  buildFilterChips();
  if(stream) return;
  try{
    stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'user'}, audio:false});
    video.srcObject = stream; await video.play();
    updateVideoFilter();
  }catch(err){
    console.warn('Camera error', err);
    alert('Camera requires HTTPS (or localhost) and permission.');
  }
}
function stopCameraIfUnused(){
  if(!document.getElementById('camView').classList.contains('hidden')) return;
  if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; video.srcObject=null; }
}
function updateVideoFilter(){
  const def = filterDefs.find(f=>f.key===currentFilter) || filterDefs[0];
  video.style.filter = def.css;
}

// Capture frame with filter baked in
 document.getElementById('shutter').addEventListener('click', ()=>{
  if(!video.srcObject){ startCamera(); return; }
  canvas.width = video.videoWidth || video.clientWidth;
  canvas.height = video.videoHeight || video.clientHeight;
  // apply same filter when drawing
  const def = filterDefs.find(f=>f.key===currentFilter) || filterDefs[0];
  ctx.filter = def.css;
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  // overlay subtle vignette
  const grd = ctx.createRadialGradient(canvas.width/2, canvas.height/2, canvas.width*0.1, canvas.width/2, canvas.height/2, canvas.width*0.8);
  grd.addColorStop(0,'rgba(0,0,0,0)'); grd.addColorStop(1,'rgba(0,0,0,0.25)');
  ctx.fillStyle = grd; ctx.fillRect(0,0,canvas.width,canvas.height);

  const data = canvas.toDataURL('image/jpeg', 0.9);
  saveToGallery(data);
});

// ---------- Notes ----------
const noteText = document.getElementById('noteText');
const notesList = document.getElementById('notesList');
function renderNotes(){
  const items = JSON.parse(localStorage.getItem('arcadia.notes')||'[]');
  notesList.innerHTML='';
  items.forEach((n,i)=>{
    const div = document.createElement('div'); div.className='note';
    div.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><strong>${n.title}</strong><button class='btn' data-del='${i}'>Delete</button></div><div>${n.body.replace(/\n/g,'<br>')}</div>`;
    notesList.appendChild(div);
  });
  // deletion
  notesList.querySelectorAll('[data-del]').forEach(b=> b.addEventListener('click', (e)=>{
    const idx = Number(e.currentTarget.dataset.del); const items = JSON.parse(localStorage.getItem('arcadia.notes')||'[]');
    items.splice(idx,1); localStorage.setItem('arcadia.notes', JSON.stringify(items)); renderNotes();
  }));
}
function saveNote(){
  const body = noteText.value.trim(); if(!body) return;
  const items = JSON.parse(localStorage.getItem('arcadia.notes')||'[]');
  const title = 'Note ‚Ä¢ '+ new Date().toLocaleString();
  items.unshift({title, body}); localStorage.setItem('arcadia.notes', JSON.stringify(items.slice(0,200)));
  noteText.value=''; renderNotes();
}
function seedNote(){
  const seeds = [
    'the cards say a change is coming near',
    'as a nestling on a bough, the fool is the martyr of the now',
    'twilight hums in amethyst and moss',
    'keys sleep under stones; gates open to song',
    'the storm is always about to come, and never does'
  ];
  noteText.value = (noteText.value? noteText.value+'\n':'') + '‚Ä¢ '+ seeds[Math.floor(Math.random()*seeds.length)];
}

document.getElementById('saveNote').addEventListener('click', saveNote);
document.getElementById('newNote').addEventListener('click', ()=> noteText.value='');
document.getElementById('seedNote').addEventListener('click', seedNote);
document.getElementById('clearNotes').addEventListener('click', ()=>{ localStorage.removeItem('arcadia.notes'); renderNotes(); });

// ---------- Oracle ----------
const prophecy = document.getElementById('prophecy');
const question = document.getElementById('question');
function castOracle(){
  const openers = ['The Moon whispers','The Tower shudders','The Star extends a hand','A gate unlatches','The river remembers'];
  const middles = ['in violet parables','through braided time','beneath the cedar veil','with eyes of quartz','as comets braid the field'];
  const enders = ['‚Äî step lightly.','‚Äî and keep a key.','‚Äî wait by the willow.','‚Äî speak only in spirals.','‚Äî the hour is near.'];
  const q = question.value.trim();
  const line = `${openers[Math.floor(Math.random()*openers.length)]} ${middles[Math.floor(Math.random()*middles.length)]} ${enders[Math.floor(Math.random()*enders.length)]}`;
  prophecy.textContent = (q? 'Q: '+q+'\n':'') + line;
}

document.getElementById('cast').addEventListener('click', castOracle);
document.getElementById('saveProphecy').addEventListener('click', ()=>{
  if(!prophecy.textContent.trim()) return;
  const items = JSON.parse(localStorage.getItem('arcadia.notes')||'[]');
  items.unshift({title:'Oracle ‚Ä¢ '+new Date().toLocaleString(), body: prophecy.textContent});
  localStorage.setItem('arcadia.notes', JSON.stringify(items.slice(0,200)));
  alert('Saved to Notes');
});

// ---------- Settings ----------
document.querySelectorAll('.swatch').forEach(s=> s.addEventListener('click', ()=>{
  const c = s.dataset.accent; document.documentElement.style.setProperty('--accent', c);
}));

document.getElementById('themeArcadia').addEventListener('click', ()=>{
  document.documentElement.style.setProperty('--bg', 'radial-gradient(1200px 800px at 20% 10%, #3b2d63 0%, #231b3e 45%, #0f0f23 100%)');
});
document.getElementById('themeDawn').addEventListener('click', ()=>{
  document.documentElement.style.setProperty('--bg', 'linear-gradient(135deg, #402a6b 0%, #7c4f7d 45%, #f2b5c6 100%)');
});
document.getElementById('themeNight').addEventListener('click', ()=>{
  document.documentElement.style.setProperty('--bg', 'radial-gradient(1000px 700px at 50% -10%, #0b0a17 0%, #111127 40%, #090913 100%)');
});

</script>
</body>
</html>
