<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Arcadia Mini Keyboard</title>
  <style>
    body {
      margin: 0;
      padding: 40px 20px;
      background: linear-gradient(135deg, #2d3561, #1a1a2e, #3d2947);
      color: white;
      font-family: 'Georgia', serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .keyboard-container {
      text-align: center;
      max-width: 1000px;
      width: 100%;
    }

    .title {
      font-size: 2.5em;
      margin-bottom: 15px;
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #c9a96e, #b19cd9);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
      letter-spacing: 2px;
    }

    .subtitle {
      font-size: 1.1em;
      margin-bottom: 40px;
      color: #b0b0b0;
      font-style: italic;
      letter-spacing: 1px;
    }

    .keyboard {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 8px;
      margin: 30px auto;
      max-width: 700px;
      padding: 30px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    .key {
      aspect-ratio: 1;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 0.8em;
      font-weight: bold;
      color: white;
      transition: all 0.15s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .key::before {
      content: '';
      position: absolute;
      inset: 0;
      opacity: 0;
      transition: opacity 0.3s ease;
      border-radius: 12px;
    }

    .key:hover::before { opacity: 0.3; }
    .key.active {
      transform: scale(0.95);
      box-shadow: 0 0 25px currentColor;
    }
    .key.active::before { opacity: 0.6; }

    /* Color scheme */
    .key:nth-child(1)  { background: linear-gradient(135deg, #dd91a7, #c986dc); }
    .key:nth-child(2)  { background: linear-gradient(135deg, #98c37c, #adbe93); }
    .key:nth-child(3)  { background: linear-gradient(135deg, #f7ca8a, #e8b366); }
    .key:nth-child(4)  { background: linear-gradient(135deg, #8cbdbb, #7ba7a5); }
    .key:nth-child(5)  { background: linear-gradient(135deg, #b19cd9, #9d87c7); }
    .key:nth-child(6)  { background: linear-gradient(135deg, #c9a96e, #b8965c); }
    .key:nth-child(7)  { background: linear-gradient(135deg, #a8a8a8, #909090); }
    .key:nth-child(8)  { background: linear-gradient(135deg, #e8a87c, #d19660); }
    .key:nth-child(9)  { background: linear-gradient(135deg, #c18fb5, #b07ca3); }
    .key:nth-child(10) { background: linear-gradient(135deg, #7fb069, #6d9e57); }
    .key:nth-child(11) { background: linear-gradient(135deg, #e6b878, #d4a566); }
    .key:nth-child(12) { background: linear-gradient(135deg, #78aba9, #669997); }
    .key:nth-child(13) { background: linear-gradient(135deg, #a38ac7, #9177b5); }
    .key:nth-child(14) { background: linear-gradient(135deg, #b7975c, #a5864a); }
    .key:nth-child(15) { background: linear-gradient(135deg, #969696, #7e7e7e); }
    .key:nth-child(16) { background: linear-gradient(135deg, #d6966e, #c4845c); }

    .controls {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    .control-btn {
      padding: 12px 20px;
      border: none;
      border-radius: 25px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .control-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }
    .control-btn.loop-active {
      outline: 2px solid rgba(255,255,255,.55);
    }

    .volume-control {
      margin-top: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    .volume-slider {
      width: 150px;
      height: 6px;
      border-radius: 3px;
      background: rgba(255, 255, 255, 0.2);
      outline: none;
      cursor: pointer;
    }

    .instructions {
      margin-top: 30px;
      font-size: 0.9em;
      color: #888;
      line-height: 1.6;
      max-width: 600px;
      text-align: center;
    }

    .visual-indicator {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      margin: 20px auto;
      background: radial-gradient(circle, rgba(255,255,255,0.1), transparent);
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }
    .visual-indicator.active {
      transform: scale(1.2);
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.4);
    }

    @media (max-width: 768px) {
      .keyboard {
        grid-template-columns: repeat(4, 1fr);
        max-width: 400px;
        padding: 20px;
      }
      .title { font-size: 2em; }
      .controls { gap: 10px; }
      .control-btn { padding: 10px 16px; font-size: 12px; }
    }
  </style>
</head>
<body>
  <div class="keyboard-container">
    <h1 class="title">Arcadia Mini</h1>
    <p class="subtitle">pastoral electronic textures for wandering minds</p>

    <div class="visual-indicator" id="visualIndicator"></div>

    <div class="keyboard" id="keyboard"></div>

    <div class="controls">
      <button class="control-btn" onclick="playArpeggio()">Garden Sequence</button>
      <button class="control-btn" onclick="playChord()">Forest Chord</button>
      <button class="control-btn" onclick="playRainLoop()">Rain Loop</button>
      <button class="control-btn" id="loopBtn" onclick="toggleLoop()">Loop Off</button>
      <button class="control-btn" onclick="clearAll()">Clear All</button>
    </div>

    <div class="volume-control">
      <span>Volume:</span>
      <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="25">
    </div>

    <div class="instructions">
      Click keys to layer ambient sounds • Each key holds pastoral frequencies and textures • Use sequences for composed moments
    </div>
  </div>

  <script>
    class ArcadiaKeyboard {
      constructor() {
        this.audioContext = null;
        this.oscillators = {};
        this.gainNodes = {};
        this.masterGain = null;
        this.isPlaying = {};
        this.isLooping = false;
        this.loopTimeout = null;
        this.currentSequence = null;
        this.frequencies = [
          174.61,196.00,220.00,246.94,261.63,293.66,329.63,349.23,
          392.00,440.00,493.88,523.25,587.33,659.25,698.46,783.99
        ];
        this.init();
      }

      async init() {
        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        this.masterGain = this.audioContext.createGain();
        this.masterGain.connect(this.audioContext.destination);
        this.masterGain.gain.value = 0.25;
        this.createKeyboard();
        this.setupEventListeners();
      }

      createKeyboard() {
        const keyboard = document.getElementById('keyboard');
        const labels = [
          'mist','dawn','leaf','dew','wind','rain','sky','moon',
          'star','snow','sage','moss','fern','pond','bird','echo'
        ];
        for (let i=0;i<16;i++){
          const key = document.createElement('button');
          key.className = 'key';
          key.dataset.index = i;
          key.textContent = labels[i];
          key.addEventListener('mousedown', () => this.startNote(i));
          key.addEventListener('mouseup', () => this.stopNote(i));
          key.addEventListener('mouseleave', () => this.stopNote(i));
          key.addEventListener('touchstart', (e)=>{ e.preventDefault(); this.startNote(i); }, {passive:false});
          key.addEventListener('touchend', (e)=>{ e.preventDefault(); this.stopNote(i); }, {passive:false});
          keyboard.appendChild(key);
        }
      }

      async startNote(index) {
        if (!this.audioContext) return;
        if (this.audioContext.state === 'suspended') await this.audioContext.resume();
        if (this.isPlaying[index]) return;
        const frequency = this.frequencies[index];
        const osc = this.audioContext.createOscillator();
        const gain = this.audioContext.createGain();
        const filter = this.audioContext.createBiquadFilter();
        filter.type='lowpass'; filter.frequency.value=1500+Math.random()*1000; filter.Q.value=0.5;
        osc.type='sine'; osc.frequency.value=frequency; osc.detune.value=(Math.random()-0.5)*15;
        gain.gain.value=0; gain.gain.setTargetAtTime(0.12,this.audioContext.currentTime,0.4);
        osc.connect(filter); filter.connect(gain); gain.connect(this.masterGain);
        osc.start();
        this.oscillators[index]=osc; this.gainNodes[index]=gain; this.isPlaying[index]=true;
        document.querySelector(`[data-index="${index}"]`).classList.add('active');
        this.updateIndicator();
      }

      stopNote(index){
        if (!this.oscillators[index] || !this.isPlaying[index]) return;
        const osc=this.oscillators[index]; const gain=this.gainNodes[index];
        gain.gain.setTargetAtTime(0,this.audioContext.currentTime,0.5);
        setTimeout(()=>{
          try{osc.stop();osc.disconnect();gain.disconnect();}catch(_){}
          delete this.oscillators[index]; delete this.gainNodes[index]; this.isPlaying[index]=false;
          document.querySelector(`[data-index="${index}"]`).classList.remove('active');
          this.updateIndicator();
        },500);
      }

      updateIndicator(){
        const active=Object.values(this.isPlaying).some(Boolean);
        document.getElementById('visualIndicator').classList.toggle('active',active);
      }

      setupEventListeners(){
        document.getElementById('volumeSlider').addEventListener('input',(e)=>{
          this.masterGain.gain.value=(e.target.value/100)*0.4;
        });
      }
    }

    let keyboard;
    function scheduleLoop(fn,delay){ if(!keyboard.isLooping)return; if(keyboard.loopTimeout)clearTimeout(keyboard.loopTimeout); keyboard.loopTimeout=setTimeout(fn,delay); }
    function cancelLoop(){ if(keyboard.loopTimeout)clearTimeout(keyboard.loopTimeout); }

    async function playArpeggio(){
      if (!keyboard?.audioContext) return;
      if (keyboard.audioContext.state==='suspended') await keyboard.audioContext.resume();
      keyboard.currentSequence='arpeggio';
      const pattern=[0,2,4,7,9,11,14,11,9,7,4,2], step=400;
      pattern.forEach((n,i)=>{ setTimeout(()=>{keyboard.startNote(n); setTimeout(()=>keyboard.stopNote(n),800);}, i*step);});
      scheduleLoop(playArpeggio, pattern.length*step+200);
    }

    async function playChord(){
      if (!keyboard?.audioContext) return;
      if (keyboard.audioContext.state==='suspended') await keyboard.audioContext.resume();
      keyboard.currentSequence='chord';
      const chord=[0,4,7,11]; chord.forEach(n=>keyboard.startNote(n)); setTimeout(()=>chord.forEach(n=>keyboard.stopNote(n)),3000);
      scheduleLoop(playChord,3200);
    }

    async function playRainLoop(){
      if (!keyboard?.audioContext) return;
      if (keyboard.audioContext.state==='suspended') await keyboard.audioContext.resume();
      keyboard.currentSequence='rain';
      const src=keyboard.audioContext.createBufferSource(), filt=keyboard.audioContext.createBiquadFilter(), gain=keyboard.audioContext.createGain();
      const len=keyboard.audioContext.sampleRate*4, buf=keyboard.audioContext.createBuffer(1,len,keyboard.audioContext.sampleRate), ch=buf.getChannelData(0);
      for(let i=0;i<len;i++) ch[i]=Math.random()*2-1;
      src.buffer=buf; src.loop=true; filt.type='bandpass'; filt.frequency.value=1200; filt.Q.value=0.5;
      gain.gain.value=0; gain.gain.setTargetAtTime(0.04,keyboard.audioContext.currentTime,1);
      src.connect(filt); filt.connect(gain); gain.connect(keyboard.masterGain);
      src.start(); setTimeout(()=>{gain.gain.setTargetAtTime(0,keyboard.audioContext.currentTime,1); setTimeout(()=>{try{src.stop();src.disconnect();filt.disconnect();gain.disconnect();}catch(_){ }},1000);},10000);
      scheduleLoop(playRainLoop,11000);
    }

    function toggleLoop(){
      keyboard.isLooping=!keyboard.isLooping;
      const btn=document.getElementById('loopBtn');
      if(keyboard.isLooping){
        btn.textContent='Loop On'; btn.classList.add('loop-active');
        if(keyboard.currentSequence==='arpeggio') playArpeggio();
        else if(keyboard.currentSequence==='chord') playChord();
        else if(keyboard.currentSequence==='rain') playRainLoop();
      }else{
        btn.textContent='Loop Off'; btn.classList.remove('loop-active'); cancelLoop(); keyboard.currentSequence=null;
      }
    }

    function clearAll(){
      for(let i=0;i<16;i++) keyboard.stopNote(i);
      keyboard.isLooping=false; cancelLoop(); keyboard.currentSequence=null;
      const btn=document.getElementById('loopBtn'); btn.textContent='Loop Off'; btn.classList.remove('loop-active');
    }

    window.addEventListener('load',()=>{ keyboard=new ArcadiaKeyboard(); });
  </script>
</body>
</html>
